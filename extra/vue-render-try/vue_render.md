# Vue 渲染简析

## Vue功能简述

### VDom能力

Vue目前包含**slot** 分发， **component** 占位和动态替换，**transition**设置过渡等特殊元素，每个元素包含html属性，dom属性， **props**（组件参数），**data**(组件数据)，**on**（组件监听，支持多种*修饰符*），还有**key**（渲染标志），**ref**（引用标志）等顶层属性，相对来讲非常复杂，基本覆盖了所有场景，支持**template** 和**render函数**两种渲染写法，使用render函数还可以引入**JSX**语法糖。

### 响应设计

Vue采用自动代理，自动追踪数据变化，相对来说减少了开发人员对**响应性**的考虑，但其中一个坑是对于新增键值使用普通方式是无法追踪的，需要通过特殊方法添加键值。Vue监测到数据变化后会注册一个**Promise** （对于点击事件等Vue监测下的用户操作，Vue会采用同步手段计算变化）去计算变化和计算子组件是否需要刷新，之后会重新运行渲染方法将变化更新到页面上，这个过程称为**patch**。

对于同步函数中的变化，由于JS的单线程事件异步的特性，patch会确保在同步完成之后再执行，但对于异步变化，Vue会进行多次计算变化与patch，并非lazy模式，这样对于响应速度来说会很有帮助，但我觉得这一点是可以优化的，在哪个时间点去patch是可以进行决策分析的。（*抛砖引玉*）

### VDom渲染更新算法
VDom渲染算法的核心是比较变化前后的两个VDom树，并将变化最简化，形成新增，修改，删除事件，并将事件应用到真实Dom上。三种事件的成本为： 新增 > 删除 > 修改。Vue的策略是最大化利用和同级比较的o(n)级别的算法，两颗树的全比较是o(n^2)级别的，对于包含索引值key的全追踪的话算法复杂度即是o(mn)m为原VDom树中包含索引值的节点数
。
